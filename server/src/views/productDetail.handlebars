<a href="/products" style="display: inline-block; margin-bottom: 20px; color: #0b3866; text-decoration: none;">
    ← Volver a productos
</a>

<div style="max-width: 800px; margin: 0 auto;">
    <h1 style="margin-bottom: 30px;">
        {{product.title}}
    </h1>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">

        <!-- IMAGEN DEL PRODUCTO -->
        <div>
            {{#if product.thumbnails.[0]}}
                <img
                    src="{{product.thumbnails.[0]}}"
                    alt="{{product.title}}"
                    style="width: 100%; height: 400px; object-fit: cover; border-radius: 5px;"
                >
            {{else}}
                <div style="
                    width: 100%;
                    height: 400px;
                    background: #f2f2f2;
                    border-radius: 5px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: #999;
                    font-size: 1rem;
                ">
                    Sin imagen
                </div>
            {{/if}}
        </div>

        <!-- INFO DEL PRODUCTO -->
        <div>
            <h2 style="color: #333; margin-bottom: 20px; font-size: 2rem;">
                ${{product.price}}
            </h2>

            <div style="margin-bottom: 20px;">
                <span style="
                    background: {{#if product.status}}#28a745{{else}}#dc3545{{/if}};
                    color: white;
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-size: 0.9rem;
                ">
                    {{#if product.status}}✓ Disponible{{else}}✗ Agotado{{/if}}
                </span>
            </div>

            <p style="color: #666; line-height: 1.6; margin-bottom: 20px; font-size: 1.1rem;">
                {{product.description}}
            </p>

            <div style="
                background: #f8f9fa;
                padding: 20px;
                border-radius: 8px;
                margin-bottom: 25px;
            ">
                <p style="margin-bottom: 10px;">
                    <strong>Categoría:</strong> {{product.category}}
                </p>
                <p style="margin-bottom: 10px;">
                    <strong>Stock:</strong> {{product.stock}} unidades
                </p>
                <p>
                    <strong>Estado:</strong>
                    {{#if product.status}}Activo{{else}}Inactivo{{/if}}
                </p>
            </div>

            {{#if product.status}}
                <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: center;">
                    <label style="font-weight: bold;">Cantidad:</label>
                    <input
                        type="number"
                        id="quantity"
                        value="1"
                        min="1"
                        max="{{product.stock}}"
                        style="
                            width: 80px;
                            padding: 8px;
                            border: 1px solid #ddd;
                            border-radius: 6px;
                            font-size: 1rem;
                        "
                    >
                </div>

                <button
                    onclick="addToCart('{{product._id}}')"
                    class="btn"
                    style="width: 100%; font-size: 1.1rem;"
                >
                    Agregar al carrito
                </button>
            {{else}}
                <button
                    class="btn"
                    disabled
                    style="opacity: 0.5; cursor: not-allowed; width: 100%;"
                >
                    Producto no disponible
                </button>
            {{/if}}
        </div>
    </div>
</div>

<script>
    async function addToCart(productId) {
        const quantity = parseInt(document.getElementById('quantity')?.value || 1);

        if (!quantity || quantity < 1) {
            alert('Cantidad inválida');
            return;
        }

        const cartId = localStorage.getItem('cartId');
        if (!cartId) {
            alert('No hay carrito disponible');
            return;
        }

        try {
            for (let i = 0; i < quantity; i++) {
                await fetch(`/api/carts/${cartId}/product/${productId}`, {
                    method: 'POST'
                });
            }

            alert(`${quantity} producto(s) agregado(s) al carrito`);
        } catch (error) {
            console.error('Error:', error);
            alert('Error al agregar al carrito');
        }
    }
</script>
