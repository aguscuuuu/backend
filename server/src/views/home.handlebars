<h1>Catálogo de productos</h1>

<div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
    <div>
        <label style="margin-right: 8px;">Categoría:</label>
        <select id="categoryFilter" style="padding: 8px; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; font-size: 14px">
            <option value="">Todas</option>
            <option value="Periféricos">Periféricos</option>
            <option value="Monitores">Monitores</option>
            <option value="Audio">Audio</option>
            <option value="Almacenamiento">Almacenamiento</option>
            <option value="Muebles">Muebles</option>
            <option value="Accesorios">Accesorios</option>
        </select>
    </div>

    <div>
        <label style="margin-right: 8px;">Ordenar por precio:</label>
        <select id="sortFilter" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; font-size: 14px">
            <option value="">Sin orden</option>
            <option value="asc">Menor a mayor</option>
            <option value="desc">Mayor a menor</option>
        </select>
    </div>

    <div>
        <label style="margin-right: 8px;">Disponibilidad:</label>
        <select id="availabilityFilter" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; font-size: 14px">
            <option value="">Todos</option>
            <option value="available">Disponibles</option>
            <option value="unavailable">No disponibles</option>
        </select>
    </div>

    <button onclick="applyFilters()" class="btn">Aplicar filtros</button>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
    {{#each products}}
    <div style="border: 1px solid #ddd; border-radius: 5px; padding: 20px; display: flex; flex-direction: column;">
        {{#if this.thumbnails.[0]}}
            <img src="{{this.thumbnails.[0]}}" alt="{{this.title}}"
                style="width: 100%; height: 215px; object-fit: cover; border-radius: 5px; margin-bottom: 12px;">
        {{else}}
            <div style="width: 100%; height: 215px; background: #f2f2f2; border-radius: 5px; margin-bottom: 12px; display: flex; align-items: center; justify-content: center; color: #999; font-size: 0.85rem;">
                Sin imagen
            </div>
        {{/if}}

        <h3 style="color: #333; margin-bottom: 10px; font-size: 1.2rem;">{{this.title}}</h3>
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 3px; min-height: 60px;">{{this.description}}</p>

        <div style="margin-top: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <span style="font-size: 1.5rem; font-weight: 600; color: #0f4881;">{{this.priceFormatted}}</span>
                <span style="background: {{#if this.status}}#28a745{{else}}#dc3545{{/if}}; color: white; padding: 4px 12px; border-radius: 5px; font-size: 0.75rem; font-weight: 600;">
                    {{#if this.status}}Disponible{{else}}Agotado{{/if}}
                </span>
            </div>

            <p style="color: #000; font-size: 0.85rem; margin-bottom: 6px;">Stock: {{this.stock}}</p>
            <p style="color: #000; font-size: 0.85rem; margin-bottom: 15px;">Categoría: {{this.category}}</p>
        </div>

        <div style="display: flex; gap: 10px;">
            <a href="/products/{{this._id}}" class="btn" style="flex: 1; text-align: center; font-size: 12px">Ver detalle</a>
            <button onclick="addToCart('{{this._id}}')" class="btn btn-secondary" style="flex: 1; font-size: 12px">Agregar</button>
        </div>
    </div>
    {{/each}}
</div>

<div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 30px;">
    {{#if hasPrevPage}}
        <a href="{{prevLink}}" class="btn">← Anterior</a>
    {{else}}
        <button class="btn" disabled style="opacity: 0.5; cursor: not-allowed;">← Anterior</button>
    {{/if}}

    <span style="font-weight: 400; color: #333;">{{page}} / {{totalPages}}</span>

    {{#if hasNextPage}}
        <a href="{{nextLink}}" class="btn">Siguiente →</a>
    {{else}}
        <button class="btn" disabled style="opacity: 0.5; cursor: not-allowed;">Siguiente →</button>
    {{/if}}
</div>

<script>
    async function addToCart(productId) {
        await window.addToCartGlobal(productId);
    }

    function applyFilters() {
        const category = document.getElementById('categoryFilter').value;
        const sort = document.getElementById('sortFilter').value;
        const availability = document.getElementById('availabilityFilter').value;

        let url = '/?';
        if (category) url += `query=${category}&`;
        if (availability) url += `query=${availability}&`;
        if (sort) url += `sort=${sort}&`;

        window.location.href = url;
    }
</script>