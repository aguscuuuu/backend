<nav>
    <div style="display: flex; gap: 20px; align-items: center; flex: 1;">
        {{#if user.isAdmin}}
            <!-- navbar para admin -->
            <a href="/realtimeproducts">‚ö° Panel Admin</a>
        {{else}}
            <!-- navbar para usuarios -->
            <a href="/">üè† Inicio</a>
            <a href="#" onclick="goToCart(); return false;">üõí Mi Carrito</a>
        {{/if}}
    </div>
    
    <div style="display: flex; gap: 15px; align-items: center;">
        {{#if user}}
            <span style="color: white;">üë§ {{user.first_name}}</span>
            {{#if user.isAdmin}}
                <span style="background: #ffc107; color: #333; padding: 4px 12px; border-radius: 12px; font-size: 0.8rem;">ADMIN</span>
            {{/if}}
            <a href="/logout" style="background: #dc3545; padding: 8px 16px; border-radius: 6px;">Cerrar sesi√≥n</a>
        {{else}}
            <a href="/login" style="background: #28a745; padding: 8px 16px; border-radius: 6px;">üîê Iniciar sesi√≥n</a>
            <a href="/register" style="background: #667eea; padding: 8px 16px; border-radius: 6px;">üìù Registrarse</a>
        {{/if}}
    </div>
</nav>

{{#unless user.isAdmin}}
<script>
    window.addEventListener('DOMContentLoaded', async () => {
        await ensureCartExists();
    });

    async function ensureCartExists() {
        let cartId = localStorage.getItem('cartId');
        
        if (cartId) {
            try {
                const response = await fetch(`/api/carts/${cartId}`);
                if (!response.ok) {
                    cartId = null;
                    localStorage.removeItem('cartId');
                }
            } catch (error) {
                cartId = null;
                localStorage.removeItem('cartId');
            }
        }
        
        if (!cartId) {
            try {
                const response = await fetch('/api/carts', { method: 'POST' });
                const data = await response.json();
                cartId = data.data._id;
                localStorage.setItem('cartId', cartId);
            } catch (error) {
                console.error('Error al crear carrito:', error);
            }
        }
        
        return cartId;
    }

    async function goToCart() {
        const cartId = await ensureCartExists();
        if (cartId) {
            window.location.href = `/carts/${cartId}`;
        }
    }

    window.addToCartGlobal = async function(productId) {
        const cartId = await ensureCartExists();
        
        try {
            const response = await fetch(`/api/carts/${cartId}/product/${productId}`, {
                method: 'POST'
            });
            const data = await response.json();
            
            if (data.status === 'success') {
                alert('‚úÖ Producto agregado al carrito');
            } else {
                alert('‚ùå Error: ' + data.message);
            }
        } catch (error) {
            alert('‚ùå Error al agregar al carrito');
        }
    };
</script>
{{/unless}}