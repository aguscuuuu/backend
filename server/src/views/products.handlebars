<h1>Cat√°logo de Productos</h1>

<div style="margin-bottom: 30px; display: flex; gap: 15px; flex-wrap: wrap;">
    <div>
        <label style="margin-right: 8px;">Categor√≠a:</label>
        <select id="categoryFilter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="">Todas</option>
            <option value="Perif√©ricos">Perif√©ricos</option>
            <option value="Monitores">Monitores</option>
            <option value="Audio">Audio</option>
            <option value="Almacenamiento">Almacenamiento</option>
            <option value="Muebles">Muebles</option>
            <option value="Accesorios">Accesorios</option>
        </select>
    </div>

    <div>
        <label style="margin-right: 8px;">Ordenar por precio:</label>
        <select id="sortFilter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="">Sin orden</option>
            <option value="asc">Menor a mayor</option>
            <option value="desc">Mayor a menor</option>
        </select>
    </div>

    <div>
        <label style="margin-right: 8px;">Disponibilidad:</label>
        <select id="availabilityFilter" style="padding: 8px; border-radius: 4px; border: 1px solid #ddd;">
            <option value="">Todos</option>
            <option value="available">Disponibles</option>
            <option value="unavailable">No disponibles</option>
        </select>
    </div>

    <button onclick="applyFilters()" class="btn">Aplicar filtros</button>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
    {{#each products}}
    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 20px; transition: transform 0.3s, box-shadow 0.3s;" 
        onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.15)';" 
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
        
        <h3 style="color: #333; margin-bottom: 10px; font-size: 1.2rem;">{{this.title}}</h3>
        <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px; min-height: 60px;">{{this.description}}</p>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${{this.price}}</span>
            <span style="background: {{#if this.status}}#28a745{{else}}#dc3545{{/if}}; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem;">
                {{#if this.status}}Disponible{{else}}Agotado{{/if}}
            </span>
        </div>

        <p style="color: #888; font-size: 0.85rem; margin-bottom: 10px;">Stock: {{this.stock}}</p>
        <p style="color: #888; font-size: 0.85rem; margin-bottom: 15px;">Categor√≠a: {{this.category}}</p>

        <div style="display: flex; gap: 10px;">
            <a href="/products/{{this._id}}" class="btn" style="flex: 1; text-align: center;">Ver detalle</a>
            <button onclick="addToCart('{{this._id}}')" class="btn btn-secondary" style="flex: 1;">
                üõí Agregar
            </button>
        </div>
    </div>
    {{/each}}
</div>

<div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 30px;">
    {{#if hasPrevPage}}
        <a href="{{prevLink}}" class="btn">‚Üê Anterior</a>
    {{else}}
        <button class="btn" disabled style="opacity: 0.5; cursor: not-allowed;">‚Üê Anterior</button>
    {{/if}}

    <span style="font-weight: bold; color: #333;">P√°gina {{page}} de {{totalPages}}</span>

    {{#if hasNextPage}}
        <a href="{{nextLink}}" class="btn">Siguiente ‚Üí</a>
    {{else}}
        <button class="btn" disabled style="opacity: 0.5; cursor: not-allowed;">Siguiente ‚Üí</button>
    {{/if}}
</div>

<script>
    const cartId = localStorage.getItem('cartId') || createCart();

    async function createCart() {
        const response = await fetch('/api/carts', { method: 'POST' });
        const data = await response.json();
        const newCartId = data.data._id;
        localStorage.setItem('cartId', newCartId);
        return newCartId;
    }

    async function addToCart(productId) {
        await window.addToCartGlobal(productId);
    }

    function applyFilters() {
        const category = document.getElementById('categoryFilter').value;
        const sort = document.getElementById('sortFilter').value;
        const availability = document.getElementById('availabilityFilter').value;

        let url = '/products?';
        
        if (category) url += `query=${category}&`;
        if (availability) url += `query=${availability}&`;
        if (sort) url += `sort=${sort}&`;

        window.location.href = url;
    }

    function applyFilters() {
        const category = document.getElementById('categoryFilter').value;
        const sort = document.getElementById('sortFilter').value;
        const availability = document.getElementById('availabilityFilter').value;

        let url = '/products?';
        
        if (category) url += `query=${category}&`;
        if (availability) url += `query=${availability}&`;
        if (sort) url += `sort=${sort}&`;

        window.location.href = url;
    }
</script>